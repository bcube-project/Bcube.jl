<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Phase field model - solidification of a liquid in supercooled state · Bcube</title><meta name="title" content="Phase field model - solidification of a liquid in supercooled state · Bcube"/><meta property="og:title" content="Phase field model - solidification of a liquid in supercooled state · Bcube"/><meta property="twitter:title" content="Phase field model - solidification of a liquid in supercooled state · Bcube"/><meta name="description" content="Documentation for Bcube."/><meta property="og:description" content="Documentation for Bcube."/><meta property="twitter:description" content="Documentation for Bcube."/><meta property="og:url" content="https://bcube-project.github.io/Bcube.jl/tutorial/phase_field_supercooled/"/><meta property="twitter:url" content="https://bcube-project.github.io/Bcube.jl/tutorial/phase_field_supercooled/"/><link rel="canonical" href="https://bcube-project.github.io/Bcube.jl/tutorial/phase_field_supercooled/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="Bcube logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Bcube</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../helmholtz/">Helmholtz equation (FE)</a></li><li><a class="tocitem" href="../heat_equation/">Heat equation (FE)</a></li><li><a class="tocitem" href="../linear_transport/">Linear transport (DG)</a></li><li class="is-active"><a class="tocitem" href>Phase field model - solidification of a liquid in supercooled state</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Theory"><span>Theory</span></a></li><li class="toplevel"><a class="tocitem" href="#Code"><span>Code</span></a></li></ul></li></ul></li><li><span class="tocitem">Advanced examples</span><ul><li><a class="tocitem" href="../../example/covo/">Euler equations - covo</a></li><li><a class="tocitem" href="../../example/euler_naca_steady/">Euler equations on a NACA0012</a></li><li><a class="tocitem" href="../../example/linear_elasticity/">Linear elasticity</a></li><li><a class="tocitem" href="../../example/linear_thermoelasticity/">Linear thermo-elasticity</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/geometry/">Geometry and mesh</a></li><li><a class="tocitem" href="../../manual/integration/">Integration</a></li><li><a class="tocitem" href="../../manual/cellfunction/">Cell function</a></li><li><a class="tocitem" href="../../manual/function_space/">Function and FE spaces</a></li><li><a class="tocitem" href="../../manual/operator/">LazyOperators</a></li></ul></li><li><a class="tocitem" href="../../howto/howto/">How to...</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/mesh/mesh/">Mesh</a></li><li><a class="tocitem" href="../../api/mesh/gmsh_utils/">GMSH</a></li><li><a class="tocitem" href="../../api/mesh/mesh_generator/">Mesh generator</a></li><li><a class="tocitem" href="../../api/interpolation/shape/">Reference shape</a></li><li><a class="tocitem" href="../../api/interpolation/function_space/">Function spaces</a></li><li><a class="tocitem" href="../../api/interpolation/spaces/">Available spaces</a></li><li><a class="tocitem" href="../../api/interpolation/fespace/">Finite element spaces</a></li><li><a class="tocitem" href="../../api/mapping/mapping/">Mapping</a></li><li><a class="tocitem" href="../../api/integration/integration/">Integration</a></li><li><a class="tocitem" href="../../api/dof/dof/">Degree of freedom</a></li><li><a class="tocitem" href="../../api/output/vtk/">VTK</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Phase field model - solidification of a liquid in supercooled state</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Phase field model - solidification of a liquid in supercooled state</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bcube-project/Bcube.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bcube-project/Bcube.jl/blob/main/docs/src/tutorial/phase_field_supercooled.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Phase-field-model-solidification-of-a-liquid-in-supercooled-state"><a class="docs-heading-anchor" href="#Phase-field-model-solidification-of-a-liquid-in-supercooled-state">Phase field model - solidification of a liquid in supercooled state</a><a id="Phase-field-model-solidification-of-a-liquid-in-supercooled-state-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-field-model-solidification-of-a-liquid-in-supercooled-state" title="Permalink"></a></h1><p>In this tutorial, a coupled system of two unsteady equations is solved using finite elements and an imex time scheme. This tutorial doesn&#39;t introduce <code>MultiFESpace</code>, check the &quot;euler&quot; example for this. Warning : this file is currently quite long to run (a few minutes).</p><h1 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h1><p>This case is taken from: Kobayashi, R. (1993). Modeling and numerical simulations of dendritic crystal growth. Physica D: Nonlinear Phenomena, 63(3-4), 410-423. In particular, the variables of the problem are denoted in the same way (<span>$p$</span> for the phase indicator and <span>$T$</span> for temperature). Consider a rectangular domain <span>$\Omega = [0, L_x] \times [0, L_y]$</span> on which we wish to solve the following equations:</p><p class="math-container">\[  \tau \partial_t p = \epsilon^2 \Delta p + p (1-p)(p - \frac{1}{2} + m(T))\]</p><p class="math-container">\[  \partial_t T = \Delta T + K \partial_t p\]</p><p>where <span>$m(T) = \frac{\alpha}{\pi} atan \left[ \gamma (T_e - T) \right]$</span>. This set of equations represents the solidification of a liquid in a supercooled state. Here <span>$T$</span> is a dimensionless temperature and <span>$p$</span> is the solid volume fraction. Lagrange finite elements are used to discretize both equations. Time marching is performed with a forward Euler scheme for the first equation and a backward Euler scheme for the second one.</p><p>To initiate the solidification process, a Dirichlet boundary condition (<span>$p=1$</span>,<span>$T=1$</span>) is applied at <span>$x=0$</span> (&quot;West&quot; boundary).</p><h1 id="Code"><a class="docs-heading-anchor" href="#Code">Code</a><a id="Code-1"></a><a class="docs-heading-anchor-permalink" href="#Code" title="Permalink"></a></h1><p>Load the necessary packages</p><pre><code class="language-julia hljs">using Bcube
using LinearAlgebra
using WriteVTK
using Random

Random.seed!(1234) # to obtain reproductible results</code></pre><p>Define some physical and numerical constants, as well as the <code>g</code> function appearing in the problem definition.</p><pre><code class="language-julia hljs">const dir = string(@__DIR__, &quot;/../&quot;) # Bcube dir
const ε = 0.01
const τ = 0.0003
const α = 0.9
const γ = 10.0
const K = 1.6
const Te = 1.0
const β = 0.0 # noise amplitude, original value : 0.01
const Δt = 0.0001 # time step
const totalTime = 1.0 # original value : 1
const nout = 50 # Number of iterations to skip before writing file
const degree = 1 # function space degree
const lx = 3.0
const ly = 1.0
const nx = 100
const ny = 20

g(T) = (α / π) * atan(γ * (Te - T))</code></pre><p>Read the mesh using <code>gmsh</code></p><pre><code class="language-julia hljs">const mesh_path = dir * &quot;input/mesh/domainPhaseField_tri.msh&quot;
const mesh = read_msh(mesh_path)</code></pre><p>Noise function : random between [-1/2,1/2]</p><pre><code class="language-julia hljs">const χ = MeshCellData(rand(ncells(mesh)) .- 0.5)</code></pre><p>Build the function space and the FE Spaces. The two unknowns will share the same FE spaces for this tutorial. Note the way we specify the Dirichlet condition in the definition of <code>U</code>.</p><pre><code class="language-julia hljs">fs = FunctionSpace(:Lagrange, degree)
U = TrialFESpace(fs, mesh, Dict(&quot;West&quot; =&gt; (x, t) -&gt; 1.0))
V = TestFESpace(U)</code></pre><p>Build FE functions</p><pre><code class="language-julia hljs">ϕ = FEFunction(U)
T = FEFunction(U)</code></pre><p>Define measures for cell integration</p><pre><code class="language-julia hljs">dΩ = Measure(CellDomain(mesh), 2 * degree + 1)</code></pre><p>Define bilinear and linear forms</p><pre><code class="language-julia hljs">a(u, v) = ∫(∇(u) ⋅ ∇(v))dΩ
m(u, v) = ∫(u ⋅ v)dΩ
l(v) = ∫(v * ϕ * (1.0 - ϕ) * (ϕ - 0.5 + g(T) + β * χ))dΩ</code></pre><p>Assemble the two constant matrices</p><pre><code class="language-julia hljs">A = assemble_bilinear(a, U, V)
M = assemble_bilinear(m, U, V)</code></pre><p>Create iterative matrices</p><pre><code class="language-julia hljs">C_ϕ = M + Δt / τ * ε^2 * A
C_T = M + Δt * A</code></pre><p>Apply Dirichlet conditions. For this example, we don&#39;t use a lifting method to impose the Dirichlet, but <code>d</code> is used to initialize the solution.</p><pre><code class="language-julia hljs">d = assemble_dirichlet_vector(U, V, mesh)
apply_dirichlet_to_matrix!((C_ϕ, C_T), U, V, mesh)</code></pre><p>Init solution and write it to a VTK file</p><pre><code class="language-julia hljs">set_dof_values!(ϕ, d)
set_dof_values!(T, d)

dict_vars = Dict(
    &quot;Temperature&quot; =&gt; (var_on_vertices(T, mesh), VTKPointData()),
    &quot;Phi&quot; =&gt; (var_on_vertices(ϕ, mesh), VTKPointData()),
)
write_vtk(dir * &quot;myout/result_phaseField_imex_1space&quot;, 0, 0.0, mesh, dict_vars)</code></pre><p>Factorize and allocate some vectors to increase performance</p><pre><code class="language-julia hljs">C_ϕ = factorize(C_ϕ)
C_T = factorize(C_T)
L = zero(d)
rhs = zero(d)
ϕ_new = zero(d)</code></pre><p>Time loop (imex time integration)</p><pre><code class="language-julia hljs">t = 0.0
itime = 0
while t &lt;= totalTime
    global t, itime
    t += Δt
    itime += 1
    @show t, totalTime

    # Integrate equation on ϕ
    L .= 0.0 # reset L
    assemble_linear!(L, l, V)
    rhs .= M * get_dof_values(ϕ) .+ Δt / τ .* L
    apply_dirichlet_to_vector!(rhs, U, V, mesh)
    ϕ_new .= C_ϕ \ rhs

    # Integrate equation on T
    rhs .= M * (get_dof_values(T) .+ K .* (ϕ_new .- get_dof_values(ϕ)))
    apply_dirichlet_to_vector!(rhs, U, V, mesh)

    # Update solution
    set_dof_values!(ϕ, ϕ_new)
    set_dof_values!(T, C_T \ rhs)

    # write solution in vtk format
    if itime % nout == 0
        dict_vars = Dict(
            &quot;Temperature&quot; =&gt; (var_on_vertices(T, mesh), VTKPointData()),
            &quot;Phi&quot; =&gt; (var_on_vertices(ϕ, mesh), VTKPointData()),
        )
        write_vtk(
            dir * &quot;myout/result_phaseField_imex_1space&quot;,
            itime,
            t,
            mesh,
            dict_vars;
            append = true,
        )
    end
end</code></pre><p>And here is an animation of the result:</p><img src="../assets/phase-field-supercooled-rectangle.gif" alt="drawing" width="700"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../linear_transport/">« Linear transport (DG)</a><a class="docs-footer-nextpage" href="../../example/covo/">Euler equations - covo »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Sunday 19 November 2023 21:12">Sunday 19 November 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
